<?php

class Controller {
	private $registry;
	private $viewsPath;
	private $modelsPath;
	private $folder;
	private $models;
	
	// On instantiation, object sets it's pathway based on registry's view source directory
	function __construct($registry) {
		if(get_class($registry) != 'Registry') die("Registry must be an object of the class Registry.");
		$this->registry = $registry;
		$this->viewsPath = $registry->get_register('VIEWS'); // Grab view dir pathway
		$this->modelsPath = $registry->get_register('MODELS'); // Grab model dir pathway
		$this->models = array(); // Models attribute is a collection of models used by the controller.
	}
	
	public function render($name) { // Ensures a view exists then renders it.
		$ds = $this->registry->get_register('DS');
		$fileName = $this->viewsPath . $ds . $this->folder . $ds . $name . ".php";  
		if(!file_exists($fileName)) die("There is no view named {$name}.");
		require_once($fileName); // Calls the predominate HTML and/or template view
	}
	
	public function switch_view_folder($folder = '') { // Switches view source folder
		if($folder == '') $this->folder = '';
			else {
				$ds = $this->registry->get_register('DS');
				$dirName = $this->viewsPath . $ds . $folder . $ds;  
				if(!is_dir($dirName)) die("There is no view directory by the name of {$folder}.");
				$this->folder = $folder; 
			}
	}
	
	// Calls models class file to be required and then storing an instance of the model in the controller
	public function load_model($name) {
		$ds = $this->registry->get_register('DS');
		$fileName = $this->modelsPath . $ds . $name . ".php";
		if(!file_exists($fileName)) die("There is no model named {$name}.");
		require_once($fileName . "_model.php");
		$className = ucfirst($name) . "_Model";
		$this->models[$name] = new $className;
	}
}

?>
